<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ğŸš€ à¸ªà¹ˆà¸‡ Flex à¸”à¹‰à¸§à¸¢ LIFF</title>
  <style>
    body { font-family: sans-serif; background: #111; color: white; padding: 1rem; }
    textarea { width: 100%; height: 300px; background: #222; color: #0f0; padding: 10px; font-family: monospace; }
    button { padding: 10px 20px; background: #ffcc00; color: black; font-size: 16px; border: none; border-radius: 6px; margin-top: 10px; }
    #status { margin-top: 10px; font-size: 14px; color: #0f0; }
  </style>
</head>
<body>
  <h2>ğŸ“¦ à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸”à¹‰à¸§à¸¢ LIFF</h2>
  <p>à¸§à¸²à¸‡à¹‚à¸„à¹‰à¸” JSON à¸ˆà¸²à¸ Flex Simulator à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡ à¹à¸¥à¹‰à¸§à¸à¸” <b>à¸ªà¹ˆà¸‡à¹€à¸¥à¸¢</b></p>

  <textarea id="jsonInput" placeholder='{ "type": "bubble", "body": { "type": "box", "layout": "vertical", ... } }'></textarea>
  <button onclick="submitFlex()">ğŸš€ à¸ªà¹ˆà¸‡à¹€à¸¥à¸¢</button>

  <p id="status"></p>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    let myId = "";

    async function submitFlex() {
      const jsonRaw = document.getElementById("jsonInput").value;
      try {
        const flex = JSON.parse(jsonRaw);
        const body = {
          to: myId,
          messages: [{
            type: "flex",
            altText: "ğŸ“¢ à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ Flex",
            contents: flex
          }]
        };

        const res = await fetch("https://api.line.me/v2/bot/message/push", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer {311bYQIl9LR2Yl+XQtmIPTPEeqXdMEsQCTyOGBsJE4Ks94lTfwm619CPab8OZxFafsiXhRvImst1PkFtsM3HpSMZLMs6I3KO1jvCe1PPp7711gEQMXhz7XU+rmq+ahOvAiQOiayJXVRUlc/xDlEWQgdB04t89/1O/w1cDnyilFU=}"
          },
          body: JSON.stringify(body)
        });

        if (res.ok) {
          document.getElementById("status").innerText = "âœ… à¸ªà¹ˆà¸‡à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§!";
        } else {
          const err = await res.text();
          document.getElementById("status").innerText = "âŒ à¸ªà¹ˆà¸‡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ: " + err;
        }

      } catch (e) {
        document.getElementById("status").innerText = "âŒ JSON à¸œà¸´à¸”à¸à¸¥à¸²à¸”: " + e;
      }
    }

    liff.init({ liffId: "2001794637-21kAVRaL" }).then(() => {
      if (!liff.isLoggedIn()) liff.login();
      else liff.getProfile().then(profile => {
        myId = profile.userId;
        document.getElementById("status").innerText = "ğŸ‘¤ Logged in as " + profile.displayName;
      });
    });
  </script>
</body>
</html>